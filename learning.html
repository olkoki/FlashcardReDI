<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Flashcard Learning</title>
  <link rel="stylesheet" href="learning.css">
  <link rel="icon" href="./favicon.ico" type="image/x-icon">
  <style>
    body{
    font-family:Arial, sans-serif ;
    text-align: center;
    background-color: #eef;
    padding: 40px;
}

main {
  margin: 0 220px;
}

.card-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 1rem;
  width: 100%;
  max-width: 600px;
  margin: auto;
}
.card{
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
  padding: 2rem;
  width: 100%;
  text-align: center;
  word-wrap: break-word;
    transition: transform 1s ease;
    transform-style: preserve-3d;

}

.card.flip {
  transform: rotateX(180deg);
}

.frontface, .backface {
  backface-visibility: hidden;
}
.backface {
  transform: rotateX(180deg);
}

/* Difficulty-based styles */
.card.easy {
    background-color: #d4edda;
    border: 2px solid green;
}
.card.medium {
    background-color: #fff3cd;
    border: 2px solid orange;
}
.card.hard {
    background-color: #f8d7da;
    border: 2px solid red;
}
.hidden {
    display: none;
}

#mark-known {
  margin-right: 5%;
  width: 10rem;
  padding: 10px;
}

#mark-difficult {
  margin-left: 5%;
  width: 10rem;
  padding: 10px;
}

.stash {
  position: fixed;
  top: 80px;
  width: 200px;
  height: calc(100% - 100px);
  background-color: #f4f4f4;
  overflow-y: auto;
  padding: 10px;
  border: 1px solid #ccc;
  font-size: 14px;
}

.stash.left {
  left: 0;
}

.stash.right {
  right: 0;
}

.stash h3 {
  text-align: center;
  margin-bottom: 10px;
}

.stash ul {
  list-style: none;
  padding: 0;
}

.stash li {
  background: #eee;
  margin-bottom: 5px;
  padding: 5px;
  border-radius: 4px;
}

ul {
  padding-left: 1rem;
  word-break: break-word;
  font-size: 0.95rem;
}

img {
  max-width: 100%;
  height: auto;
}

.end-buttons {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-top: 1rem;
}

.end-buttons button {
  padding: 10px 15px;
  font-size: 1rem;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background-color: #3b82f6;
  color: white;
  transition: background 0.2s ease;
}

.end-buttons button:hover {
  background-color: #2563eb;
}


  /* When the screen is less than 600 pixels wide, hide all links, except for the first one ("Home"). Show the link that contains should open and close the topnav (.icon) */
@media screen and (max-width: 768px) {
    .topnav a:not(:first-child) {display: none;}
    .topnav a.icon {
      float: right;
      display: block;
    }
    .card {
      padding: 1.5rem;
      font-size: 1rem;
    }
    .buttons-container {
      flex-direction: column;
      gap: 10px;
    }
    .buttons-container button {
      width: 100%;
    }
  }
  
  /* The "responsive" class is added to the topnav with JavaScript when the user clicks on the icon. This class makes the topnav look good on small screens (display the links vertically instead of horizontally) */
  @media screen and (max-width: 480px) {
    .topnav.responsive {position: relative;}
    .topnav.responsive a.icon {
      position: absolute;
      right: 0;
      top: 0;
    }
    .topnav.responsive a {
      float: none;
      display: block;
      text-align: left;
    }
    .card {
      font-size: 0.9rem;
      padding: 1rem;
    }
  }

  </style>
</head>
<body>
  <main>
    <h1>Flashcard Learning</h1>
    <!-- Filters Section -->
    <div class="filters">
        <label for="filter-difficulty">Filter by Difficulty:</label>
        <select id="filter-difficulty">
          <option value="">All</option>
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>  
        <label for="filter-category">Filter by Category:</label>
<input type="text" id="filter-category" placeholder="e.g. Math,Science">
</div>

<div class="card-container">
  <div class="card" id="card">
    <div id="question" class="frontface"></div>
    <div id="answer" class="backface"></div>
    <div id="end-message" class="hidden">
      <p>ðŸŽ‰ Youâ€™ve reached the end of the deck!</p>
    </div>
  </div>

  <div class="buttons-container">
    <button id="mark-known">Learned!</button>
    <button id="mark-difficult">Still difficult</button>
  </div>
</div>

  </main>

    <div id="known-stash" class="stash-left">
      <h3>Known</h3>
      <ul id="known-list"></ul>
      <button id="undo-known">Undo</button>
    </div>

    <div id="difficult-stash" class="stash-right">
      <h3>Difficult</h3>
      <ul id="difficult-list"></ul>
      <button id="undo-difficult">Undo</button>
    </div>


    <br>
    <br>

    <button id="prev">Previous</button>
    <button id="shuffle">Shuffle</button>
    <button id="next">Next</button>

  <div style="background:#ccc;height:8px;margin:10px 0;">
    <div id="progress-bar" style="height:100%;background:#04AA6D;width:0%;"></div>
  </div>
  <p id="progress"></p>

  <script>
    
// Load flashcards from localStorage

let allCards = JSON.parse(localStorage.getItem("flashcards")) || [];
let filteredCards = [...allCards]; 
let currentIndex=0;
let showingAnswer=false;


// DOM elements
const cardElement = document.getElementById("card");
const questionElement = document.getElementById("question");
const answerElement = document.getElementById("answer");
const nextButton = document.getElementById("next");
const shuffleButton = document.getElementById("shuffle");
const progressElement = document.getElementById("progress");
const filterDifficulty = document.getElementById("filter-difficulty");
const filterCategory = document.getElementById("filter-category");
const markKnownButton = document.getElementById("mark-known"); // Moved here
const markDifficultButton = document.getElementById("mark-difficult"); // Moved here

//  Filter flashcards by difficulty and category
function applyFilters() {
    const difficulty = filterDifficulty.value.toLowerCase();
    const category = filterCategory.value.trim().toLowerCase();
  
    filteredCards = allCards.filter(card => {
        const matchesDifficulty = !difficulty || card.difficulty === difficulty;
        const matchesCategory = !category || (card.category && card.category.toLowerCase().includes(category));
        return matchesDifficulty && matchesCategory;
    });

    currentIndex = 0;
    showCard(currentIndex);

    // Ensure buttons are visible if there are cards
    if (filteredCards.length > 0) {
        markKnownButton.style.display = 'inline-block';
        markDifficultButton.style.display = 'inline-block';
    } else {
        markKnownButton.style.display = 'none';
        markDifficultButton.style.display = 'none';
    }
}

// Container to hold end buttons
const endButtonsContainer = document.createElement("div");
endButtonsContainer.className = "end-buttons";
endButtonsContainer.style.display = "none"; // Hide by default
document.querySelector("main").appendChild(endButtonsContainer);

// Show the current flashcard
function showCard(index) {
    if (filteredCards.length === 0) {
        questionElement.textContent = "No flashcards";
        answerElement.textContent = "";
        progressElement.textContent = "";
        cardElement.className = "card";
        document.getElementById("progress-bar").style.width = "0%";
        return;
    }
    const card = filteredCards[index];
    showingAnswer = false;
    questionElement.textContent = card.question;
    answerElement.textContent = card.answer;
    answerElement.classList.add("hidden");
    questionElement.classList.remove("hidden");

    cardElement.className = "card " + card.difficulty; // color-coded by difficulty
    progressElement.textContent = `Card ${index + 1} of ${filteredCards.length}`; // Corrected template literal
    const progress = ((index + 1) / filteredCards.length) * 100;
    document.getElementById("progress-bar").style.width = `${progress}%`; // Corrected template literal
    endButtonsContainer.style.display = "none"; // Hide during normal viewing


    if (filteredCards.length === 0 || index >= filteredCards.length) {
        questionElement.classList.add("hidden");
        answerElement.classList.add("hidden");
        document.getElementById("end-message").classList.remove("hidden");
        progressElement.textContent = "";
        document.getElementById("progress-bar").style.width = "100%";
        endButtonsContainer.style.display = "flex";
        return;
    } else {
        document.getElementById("end-message").classList.add("hidden");
    }
}


// Flip the card
cardElement.addEventListener("click",() => {
if(filteredCards.length ===0)return;
showingAnswer=!showingAnswer;
cardElement.classList.toggle("flip", showingAnswer);
questionElement.classList.toggle("hidden",showingAnswer);
answerElement.classList.toggle("hidden", !showingAnswer);
});

document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowRight") nextButton.click();
  if (e.key === "ArrowLeft") prevButton.click();
  if (e.key === " ") cardElement.click(); // Flip card
});


// Next card
nextButton.addEventListener("click", () =>{
if(filteredCards.length===0)return;
currentIndex=(currentIndex +1) % filteredCards.length;
showCard(currentIndex);
});

//Previous
const prevButton = document.getElementById("prev");
prevButton.addEventListener("click", () => {
  if (filteredCards.length === 0) return;
  currentIndex = (currentIndex - 1 + filteredCards.length) % filteredCards.length;
  showCard(currentIndex);
});

// Shuffle cards
shuffleButton.addEventListener("click",()=>{
  for (let i = filteredCards.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1)); // Picks a random index j, where 0 â‰¤ j â‰¤ i.
    [filteredCards[i], filteredCards[j]] = [filteredCards[j], filteredCards[i]];
  }
  currentIndex = 0;
  showCard(currentIndex);
});


// Apply filters when user changes dropdown/input
filterDifficulty.addEventListener("change", applyFilters);
filterCategory.addEventListener("input", applyFilters);

// Load initial cards
applyFilters();


const knownList = document.getElementById("known-list");
const difficultList = document.getElementById("difficult-list");

// Track known and difficult cards
let knownCards = [];
let difficultCards = [];
let knownUndoStack = [];
let difficultUndoStack = [];

function updateUndoButtons() {
  document.getElementById("undo-known").disabled = knownUndoStack.length === 0;
  document.getElementById("undo-difficult").disabled = difficultUndoStack.length === 0;
}



function addToStash(card, type) {
  const listItem = document.createElement("li");
  listItem.textContent = card.question;
  listItem.dataset.question = card.question;

  if (type === "known") {
    knownCards.push(card);
    knownList.appendChild(listItem);
    knownUndoStack.push({ card, element: listItem }); // push to undo stack
  } else if (type === "difficult") {
    difficultCards.push(card);
    difficultList.appendChild(listItem);
    difficultUndoStack.push({ card, element: listItem }); // push to undo stack
  }

  filteredCards.splice(currentIndex, 1);
  if (currentIndex >= filteredCards.length) currentIndex = 0;
  showCard(currentIndex);

  updateUndoButtons(); 
  updateProgress();
}

function updateProgress() {
  const totalCards = allCards.length;
  const learnedCount = knownCards.length;
  const difficultCount = difficultCards.length;

  const progressText = `Learned: ${learnedCount}/${totalCards} (${Math.round((learnedCount / totalCards) * 100)}%) | Difficult: ${difficultCount}/${totalCards} (${Math.round((difficultCount / totalCards) * 100)}%)`;
  document.getElementById("progress").textContent = progressText;
}

markKnownButton.addEventListener("click", () => {
    if (filteredCards.length === 0) return; // Prevent errors if no cards are available
    addToStash(filteredCards[currentIndex], "known");

    if (filteredCards.length === 0) {
        markKnownButton.style.display = 'none';
        markDifficultButton.style.display = 'none';
        endButtonsContainer.style.display = 'block';
    }
});

markDifficultButton.addEventListener("click", () => {
    if (filteredCards.length === 0) return; // Prevent errors if no cards are available
    addToStash(filteredCards[currentIndex], "difficult");

    if (filteredCards.length === 0) {
        markKnownButton.style.display = 'none';
        markDifficultButton.style.display = 'none';
        endButtonsContainer.style.display = 'block';
    }
});

document.getElementById("undo-known").addEventListener("click", () => {
  const last = knownUndoStack.pop();
  if (!last) return;

  knownCards = knownCards.filter(c => c !== last.card);
  knownList.removeChild(last.element);

  filteredCards.splice(currentIndex, 0, last.card);
  showCard(currentIndex);

  updateUndoButtons(); 
});

document.getElementById("undo-difficult").addEventListener("click", () => {
  const last = difficultUndoStack.pop();
  if (!last) return;

  difficultCards = difficultCards.filter(c => c !== last.card);
  difficultList.removeChild(last.element);

  filteredCards.splice(currentIndex, 0, last.card);
  showCard(currentIndex);

  updateUndoButtons();
});



// Start Over button
const startOverButton = document.createElement("button");
startOverButton.textContent = "Start Over";
startOverButton.addEventListener("click", () => {
  filteredCards = [...allCards];
  currentIndex = 0;
  knownCards = [];
  difficultCards = [];
  knownUndoStack = [];
  difficultUndoStack = [];
  knownList.innerHTML = "";
  difficultList.innerHTML = "";
  endButtonsContainer.style.display = "none";

  markKnownButton.style.display = 'inline-block';
  markDifficultButton.style.display = 'inline-block';
  updateUndoButtons();
  showCard(currentIndex);
});
endButtonsContainer.appendChild(startOverButton);

// Create New button
const createButton = document.createElement("button");
createButton.textContent = "Add New Flashcards";
createButton.addEventListener("click", () => {
  // You can redirect to a flashcard creation page or open a form modal
  window.location.href = "create.html"; // Change to your actual creation page
});
endButtonsContainer.appendChild(createButton);

// Add Skip button
const skipButton = document.createElement("button");
skipButton.textContent = "Skip";
skipButton.addEventListener("click", () => {
  if (filteredCards.length === 0) return;
  currentIndex = (currentIndex + 1) % filteredCards.length;
  showCard(currentIndex);
});
endButtonsContainer.appendChild(skipButton);

// Add search functionality
const searchInput = document.createElement("input");
searchInput.type = "text";
searchInput.placeholder = "Search flashcards...";
searchInput.addEventListener("input", () => {
  const query = searchInput.value.toLowerCase();
  filteredCards = allCards.filter(card =>
    card.question.toLowerCase().includes(query) ||
    (card.answer && card.answer.toLowerCase().includes(query))
  );
  currentIndex = 0;
  showCard(currentIndex);
});
document.querySelector(".filters").appendChild(searchInput);

let skipStack = [];

skipButton.addEventListener("click", () => {
  if (filteredCards.length === 0) return;
  skipStack.push(filteredCards[currentIndex]);
  currentIndex = (currentIndex + 1) % filteredCards.length;
  showCard(currentIndex);
});

document.getElementById("undo-skip").addEventListener("click", () => {
  const lastSkipped = skipStack.pop();
  if (!lastSkipped) return;
  filteredCards.splice(currentIndex, 0, lastSkipped);
  showCard(currentIndex);
});

  </script>
</body>
</html>